<div class="mx-auto max-w-4xl" data-controller="settings-form">
  <% if notice = flash[:notice] %>
    <p class="py-2 px-3 bg-green-500/10 border border-green-500/20 mb-5 text-green-400 font-medium rounded-lg inline-block"><%= notice %></p>
  <% end %>

  <% if alert = flash[:alert] %>
    <p class="py-2 px-3 bg-red-500/10 border border-red-500/20 mb-5 text-red-400 font-medium rounded-lg inline-block"><%= alert %></p>
  <% end %>

  <%= form_with url: bulk_update_admin_settings_path, method: :patch, data: { settings_form_target: "form" } do |form| %>
    <div class="flex justify-between items-center mb-8">
      <h1 class="font-bold text-4xl text-white">Settings</h1>
      <div class="flex items-center gap-4">
        <span data-settings-form-target="status" class="text-sm text-gray-500 hidden">Saving...</span>
        <%= form.submit "Save All", class: "rounded-md px-4 py-2 bg-blue-600 hover:bg-blue-500 text-white cursor-pointer" %>
      </div>
    </div>

    <% @settings_by_category.each do |category, settings| %>
      <div class="bg-gray-900 rounded-lg border border-gray-800 mb-6">
        <div class="px-6 py-4 border-b border-gray-800">
          <h2 class="font-bold text-xl text-white"><%= SettingsService::CATEGORIES[category] || category.titleize %></h2>
        </div>
        <div class="p-6 space-y-6">
          <% settings.each do |key, data| %>
            <div class="flex flex-col md:flex-row md:items-start gap-4">
              <div class="md:w-1/3">
                <label for="settings_<%= key %>" class="font-medium text-gray-300"><%= key.to_s.titleize %></label>
                <p class="text-sm text-gray-500"><%= data[:definition][:description] %></p>
              </div>
              <div class="md:w-2/3">
                <% case data[:definition][:type] %>
                <% when "boolean" %>
                  <%= form.select "settings[#{key}]", [["Yes", "true"], ["No", "false"]], { selected: data[:value].to_s }, id: "settings_#{key}", class: "w-full rounded-md border border-gray-700 bg-gray-800 text-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 px-3 py-2", data: { action: "change->settings-form#autoSave" } %>
                <% when "integer" %>
                  <%= form.number_field "settings[#{key}]", value: data[:value], id: "settings_#{key}", class: "w-full rounded-md border border-gray-700 bg-gray-800 text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 px-3 py-2", data: { action: "change->settings-form#autoSave" } %>
                <% when "json" %>
                  <%= form.text_field "settings[#{key}]", value: data[:value].is_a?(Array) ? data[:value].join(', ') : data[:value], id: "settings_#{key}", class: "w-full rounded-md border border-gray-700 bg-gray-800 text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 px-3 py-2", data: { action: "change->settings-form#autoSave" } %>
                  <p class="mt-1 text-xs text-gray-500">For multiple values, use comma-separated format (e.g., en, fr, de)</p>
                <% else %>
                  <% if key.to_s.include?("password") || key.to_s.include?("api_key") %>
                    <%= form.password_field "settings[#{key}]", value: data[:value], placeholder: data[:value].present? ? "********" : "", id: "settings_#{key}", class: "w-full rounded-md border border-gray-700 bg-gray-800 text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 px-3 py-2", data: { action: "change->settings-form#autoSave" } %>
                  <% else %>
                    <%= form.text_field "settings[#{key}]", value: data[:value], id: "settings_#{key}", class: "w-full rounded-md border border-gray-700 bg-gray-800 text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 px-3 py-2", data: { action: "change->settings-form#autoSave" } %>
                  <% end %>
                <% end %>
              </div>
            </div>
          <% end %>
        </div>
      </div>
    <% end %>
  <% end %>
</div>
